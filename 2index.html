<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>30 Mejores Lugares para Bucear en México — Mapa Interactivo</title>

  <!-- Leaflet CSS (sin integrity para compatibilidad garantizada) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    :root{
      --navy:#001f3f;
      --accent:#116CB2;
      --muted:#f5f7fb;
      --card-bg: rgba(255,255,255,0.06);
    }
    html,body{height:100%;margin:0}
    body{
      background: linear-gradient(180deg,var(--navy),#023b56);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:#fff;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Layout */
    .container{display:flex;gap:16px;height:100vh;padding:18px;box-sizing:border-box}
    .panel{width:380px;max-width:40%;background:rgba(255,255,255,0.03);border-radius:12px;padding:14px;box-shadow:0 8px 30px rgba(0,0,0,0.45);overflow:auto}
    .map-wrap{flex:1;border-radius:12px;overflow:hidden;box-shadow:0 8px 30px rgba(0,0,0,0.45);position:relative}
    #map{position:absolute;inset:0;height:100%;width:100%}

    h1{font-size:18px;margin:0 0 8px 0}
    .meta{font-size:13px;opacity:0.9;margin-bottom:10px}
    .search{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;margin-bottom:12px}
    .filters{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
    .btn{background:transparent;border:1px solid rgba(255,255,255,0.08);padding:8px 10px;border-radius:8px;color:#fff;font-size:13px;cursor:pointer}
    .btn.active{background:var(--accent);border-color:var(--accent)}
    .site-item{padding:10px;border-radius:10px;margin-bottom:10px;background:var(--card-bg);border:1px solid rgba(255,255,255,0.03);cursor:pointer;transition:transform .15s,box-shadow .15s}
    .site-item:hover{transform:translateY(-3px);box-shadow:0 10px 30px rgba(0,0,0,0.45)}
    .thumb{width:100%;height:110px;object-fit:cover;border-radius:8px;margin-top:8px}
    .meta-small{font-size:12px;opacity:0.85}
    .popup-card{width:280px}
    .popup-card img{width:100%;height:140px;object-fit:cover;border-radius:6px;margin-bottom:8px}
    .credits{font-size:12px;opacity:0.7;margin-top:8px}

    @media(max-width:900px){
      .container{flex-direction:column;padding:10px}
      .panel{width:100%;max-height:36vh}
      .map-wrap{height:64vh}
      #map{position:relative}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="panel" aria-label="Panel lateral">
      <h1>30 Mejores Lugares para Bucear en México</h1>
      <div class="meta">Haz clic en un marcador o en una ficha para ver la ficha completa. Miniaturas fijas para carga estable.</div>

      <input id="search" class="search" placeholder="Buscar sitio, región o tipo..." aria-label="Buscar sitios" />

      <div class="filters" role="toolbar" aria-label="Filtros por región">
        <button class="btn active" data-filter="all">Todos</button>
        <button class="btn" data-filter="Caribe">Caribe</button>
        <button class="btn" data-filter="Pacífico">Pacífico</button>
        <button class="btn" data-filter="Cenotes">Cenotes</button>
      </div>

      <div id="list" aria-live="polite"></div>

      <div class="credits">Imágenes de ejemplo (picsum.photos) usadas como miniaturas fijas para estabilidad. Reemplaza por tus fotos si lo deseas.</div>
    </div>

    <div class="map-wrap" role="region" aria-label="Mapa interactivo">
      <div id="map"></div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // ---------- 30 SITES with fixed small thumbnails (picsum.photos ids) ----------
    const SITES = [
      {id:1, name:'Cozumel', region:'Caribe', type:'Arrecife', difficulty:'Intermedio', bestMonths:'Ene-Dic', lat:20.42298, lng:-86.92234, desc:'Barrera arrecifal mesoamericana; visibilidad excepcional.', img:'https://picsum.photos/id/10/600/400'},
      {id:2, name:'Isla Mujeres', region:'Caribe', type:'Pelágicos / MUSA', difficulty:'Principiante–Intermedio', bestMonths:'Oct-Abr', lat:21.2310, lng:-86.7316, desc:'Museo Subacuático de Arte y encuentros con tiburones gata.', img:'https://picsum.photos/id/20/600/400'},
      {id:3, name:'Cancún', region:'Caribe', type:'Turístico / Museo', difficulty:'Principiante', bestMonths:'Ene-Dic', lat:21.1619, lng:-86.8515, desc:'MUSA y arrecifes accesibles.', img:'https://picsum.photos/id/30/600/400'},
      {id:4, name:'Playa del Carmen', region:'Caribe', type:'Pelágicos', difficulty:'Intermedio–Avanzado', bestMonths:'Nov-Mar', lat:20.6296, lng:-87.0739, desc:'Buena temporada de bull sharks (nov-mar).', img:'https://picsum.photos/id/40/600/400'},
      {id:5, name:'Mahahual', region:'Caribe', type:'Arrecife', difficulty:'Principiante–Intermedio', bestMonths:'Nov-Jun', lat:18.7087, lng:-87.7082, desc:'Arrecifes prístinos y menos concurridos.', img:'https://picsum.photos/id/50/600/400'},
      {id:6, name:'Banco Chinchorro', region:'Caribe', type:'Atolón / Naufragios', difficulty:'Intermedio', bestMonths:'Nov-May', lat:18.6072, lng:-87.6350, desc:'Atolón remoto con naufragios.', img:'https://picsum.photos/id/60/600/400'},
      {id:7, name:'Akumal', region:'Caribe', type:'Tortugas', difficulty:'Principiante', bestMonths:'Ene-Dic', lat:20.3574, lng:-87.3084, desc:'Famoso por tortugas verdes.', img:'https://picsum.photos/id/70/600/400'},
      {id:8, name:'Tulum (Cenotes)', region:'Cenotes', type:'Cenotes / Cavernas', difficulty:'Cueva (cert.)', bestMonths:'Ene-Dic', lat:20.2110, lng:-87.4650, desc:'Sistemas de cuevas y luz cenital.', img:'https://picsum.photos/id/80/600/400'},
      {id:9, name:'Cenote Dos Ojos', region:'Cenotes', type:'Cenote', difficulty:'Caverna', bestMonths:'Ene-Dic', lat:20.3830, lng:-87.3540, desc:'Uno de los sistemas de cuevas más famosos.', img:'https://picsum.photos/id/90/600/400'},
      {id:10, name:'Cenote Angelita', region:'Cenotes', type:'Cenote', difficulty:'Intermedio–Avanzado', bestMonths:'Ene-Dic', lat:20.3087, lng:-87.3826, desc:'Capa de sulfuro crea efecto visual único.', img:'https://picsum.photos/id/100/600/400'},
      {id:11, name:'Gran Cenote', region:'Cenotes', type:'Cenote', difficulty:'Principiante–Intermedio', bestMonths:'Ene-Dic', lat:20.3270, lng:-87.5450, desc:'Accesible y visualmente impresionante.', img:'https://picsum.photos/id/101/600/400'},
      {id:12, name:'Cenote The Pit', region:'Cenotes', type:'Cenote', difficulty:'Avanzado', bestMonths:'Ene-Dic', lat:20.2730, lng:-87.4620, desc:'Profundo y espectacular.', img:'https://picsum.photos/id/102/600/400'},
      {id:13, name:'Puerto Morelos', region:'Caribe', type:'Arrecife', difficulty:'Principiante', bestMonths:'Ene-Dic', lat:20.8260, lng:-86.8723, desc:'Parque Nacional Arrecifes.', img:'https://picsum.photos/id/103/600/400'},
      {id:14, name:'Isla Contoy', region:'Caribe', type:'Reserva / Arrecife', difficulty:'Principiante–Intermedio', bestMonths:'Nov-May', lat:21.4510, lng:-86.8660, desc:'Reserva protegida con arrecifes prístinos.', img:'https://picsum.photos/id/104/600/400'},
      {id:15, name:'Cenote Calavera', region:'Cenotes', type:'Caverna', difficulty:'Intermedio', bestMonths:'Ene-Dic', lat:20.2118, lng:-87.4323, desc:'Entrada característica y experiencia única.', img:'https://picsum.photos/id/105/600/400'},
      {id:16, name:'Cabo Pulmo', region:'Pacífico', type:'Arrecife', difficulty:'Intermedio', bestMonths:'Nov-May', lat:23.4488, lng:-109.3996, desc:'Único arrecife vivo en la costa oeste.', img:'https://picsum.photos/id/106/600/400'},
      {id:17, name:'Archipiélago de Revillagigedo (Socorro)', region:'Pacífico', type:'Pelágicos / Liveaboard', difficulty:'Avanzado', bestMonths:'Nov-May', lat:18.8394, lng:-112.9066, desc:'Pelágicos grandes: mantas y tiburones.', img:'https://picsum.photos/id/107/600/400'},
      {id:18, name:'Isla Guadalupe', region:'Pacífico', type:'Jaula / Tiburones', difficulty:'Avanzado', bestMonths:'Ago-Nov', lat:29.1000, lng:-118.3000, desc:'Buceo en jaula con tiburones blancos.', img:'https://picsum.photos/id/108/600/400'},
      {id:19, name:'Bahía de los Ángeles', region:'Pacífico', type:'Pelágicos', difficulty:'Intermedio', bestMonths:'Jul-Sep', lat:28.9540, lng:-113.5600, desc:'Avistamiento de tiburón ballena y fauna rica.', img:'https://picsum.photos/id/109/600/400'},
      {id:20, name:'La Paz', region:'Pacífico', type:'Fauna / Lobos Marinos', difficulty:'Principiante–Intermedio', bestMonths:'Oct-May', lat:24.1426, lng:-110.3106, desc:'Lobos marinos y mantarrayas.', img:'https://picsum.photos/id/110/600/400'},
      {id:21, name:'Cabo San Lucas', region:'Pacífico', type:'Arrecife / Pelágicos', difficulty:'Intermedio', bestMonths:'Nov-Mar', lat:22.8894, lng:-109.9167, desc:'Formaciones rocosas y vida pelágica.', img:'https://picsum.photos/id/111/600/400'},
      {id:22, name:'Loreto', region:'Pacífico', type:'Parque Marino', difficulty:'Intermedio', bestMonths:'Oct-May', lat:26.0112, lng:-111.3439, desc:'Parque Nacional Marino con rica biodiversidad.', img:'https://picsum.photos/id/112/600/400'},
      {id:23, name:'Puerto Vallarta', region:'Pacífico', type:'Arrecife', difficulty:'Principiante–Intermedio', bestMonths:'Nov-Jun', lat:20.6534, lng:-105.2253, desc:'Buceo accesible y vida marina diversa.', img:'https://picsum.photos/id/113/600/400'},
      {id:24, name:'Islas Marietas', region:'Pacífico', type:'Rocas / Cuevas', difficulty:'Principiante–Intermedio', bestMonths:'Nov-May', lat:20.7098, lng:-105.5049, desc:'Formaciones rocosas y biodiversidad marina.', img:'https://picsum.photos/id/114/600/400'},
      {id:25, name:'Manzanillo', region:'Pacífico', type:'Naufragios', difficulty:'Intermedio', bestMonths:'Nov-May', lat:19.0550, lng:-104.3167, desc:'Naufragios y vida pelágica.', img:'https://picsum.photos/id/115/600/400'},
      {id:26, name:'Huatulco', region:'Pacífico', type:'Bahías Protegidas', difficulty:'Principiante–Intermedio', bestMonths:'Nov-May', lat:15.8470, lng:-96.1350, desc:'Bahías con corales blandos y peces.', img:'https://picsum.photos/id/116/600/400'},
      {id:27, name:'Zihuatanejo / Ixtapa', region:'Pacífico', type:'Arrecifes', difficulty:'Principiante–Intermedio', bestMonths:'Nov-May', lat:17.6400, lng:-101.5480, desc:'Arrecifes tranquilos y tortugas.', img:'https://picsum.photos/id/117/600/400'},
      {id:28, name:'Isla Isabel', region:'Pacífico', type:'Arrecife', difficulty:'Intermedio', bestMonths:'Nov-May', lat:21.8810, lng:-105.2210, desc:'Isla volcánica con arrecifes y aves marinas.', img:'https://picsum.photos/id/118/600/400'},
      {id:29, name:'Mazatlán', region:'Pacífico', type:'Naufragios', difficulty:'Intermedio', bestMonths:'Nov-May', lat:23.2494, lng:-106.4111, desc:'Naufragios y fauna del Pacífico.', img:'https://picsum.photos/id/119/600/400'},
      {id:30, name:'Bahía Magdalena', region:'Pacífico', type:'Ballenas / Observación', difficulty:'Principiante', bestMonths:'Feb-Apr', lat:24.5000, lng:-112.0000, desc:'Ballenas grises y snorkel con fauna.', img:'https://picsum.photos/id/120/600/400'}
    ];

    // Initialize map
    const map = L.map('map', {zoomControl:true, preferCanvas:true}).setView([23.6345,-102.5528],5);

    // Tile layer (OpenStreetMap)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
      maxZoom: 18,
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // Add markers and list
    const markers = [];
    const listEl = document.getElementById('list');

    SITES.forEach(site=>{
      const marker = L.marker([site.lat, site.lng]).addTo(map);
      const popupHtml = `
        <div class="popup-card" role="dialog" aria-label="${site.name} ficha">
          <img src="${site.img}" alt="${site.name} miniatura" />
          <strong>${site.name}</strong>
          <div class="meta-small">${site.region} • ${site.type}</div>
          <div class="meta-small">Dificultad: ${site.difficulty} • Mejores: ${site.bestMonths}</div>
          <p style="margin-top:8px;font-size:13px;color:#eef">${site.desc}</p>
        </div>
      `;
      marker.bindPopup(popupHtml, {maxWidth:320});
      markers.push(marker);

      // Create list item
      const item = document.createElement('div');
      item.className = 'site-item';
      item.tabIndex = 0;
      item.innerHTML = `<strong>${site.name}</strong><div class="meta-small">${site.region} • ${site.type}</div><img class="thumb" src="${site.img}" alt="${site.name}">`;
      item.addEventListener('click', ()=> {
        map.setView([site.lat, site.lng], 9, {animate:true});
        marker.openPopup();
      });
      // keyboard accessibility
      item.addEventListener('keypress', (e)=>{ if(e.key==='Enter') item.click(); });
      item.dataset.region = site.region;
      item.dataset.name = site.name.toLowerCase();
      item.dataset.type = site.type.toLowerCase();
      listEl.appendChild(item);
    });

    // Fit bounds to markers (with padding)
    const group = L.featureGroup(markers);
    if (markers.length === 1) {
      map.setView(markers[0].getLatLng(), 8);
    } else {
      map.fitBounds(group.getBounds().pad(0.2));
    }

    // Filters
    document.querySelectorAll('.btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const f = btn.dataset.filter;
        document.querySelectorAll('.site-item').forEach(i=>{
          if(f==='all') i.style.display='block';
          else i.style.display = (i.dataset.region === f) ? 'block' : 'none';
        });
      });
    });

    // Search
    document.getElementById('search').addEventListener('input', e=>{
      const q = e.target.value.trim().toLowerCase();
      document.querySelectorAll('.site-item').forEach(i=>{
        const matches = i.dataset.name.includes(q) || i.dataset.type.includes(q);
        i.style.display = (q === '' || matches) ? 'block' : 'none';
      });
    });

    // Disable scroll zoom for friendly embed; enable on ctrl+wheel
    map.scrollWheelZoom.disable();
    map.getContainer().addEventListener('wheel', function(e){
      if (e.ctrlKey) map.scrollWheelZoom.enable();
    });

    // Important: invalidate size after a short delay so Leaflet renders correctly in iframes/Canva
    window.addEventListener('load', ()=>{ setTimeout(()=>{ map.invalidateSize(); }, 250); });
    // Also attempt resize on orientation change
    window.addEventListener('orientationchange', ()=>{ setTimeout(()=>map.invalidateSize(),300); });
  </script>
</body>
</html>
